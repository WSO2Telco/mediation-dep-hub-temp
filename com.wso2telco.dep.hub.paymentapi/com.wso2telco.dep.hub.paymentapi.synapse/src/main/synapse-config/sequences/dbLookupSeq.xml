<?xml version="1.0" encoding="UTF-8"?>
<sequence name="dbLookupSeq" onError="celcomUserInfoSeq" xmlns="http://ws.apache.org/ns/synapse">
    <property expression="$trp:Authorization" name="auth-header"
              scope="default" type="STRING"/>
    <property expression="$trp:x-jwt-assertion" name="jwt-header"
              scope="default" type="STRING"/>
    <property expression="get-property('endUserId')" name="uri.var.userAddress"
              scope="default" type="STRING"/>
    <dblookup>
        <connection>
            <pool>
                <dsName>jdbc/WSO2TELCO_DEP_DB</dsName>
            </pool>
        </connection>
        <statement>
            <sql><![CDATA[select package from userinfo where enduserid=?]]></sql>
            <parameter xmlns:ns="http://org.apache.synapse/xsd"
                       expression="get-property('endUserId')" type="VARCHAR"/>
            <result column="package" name="packageType"/>
        </statement>
    </dblookup>
    <filter xmlns:ns="http://org.apache.synapse/xsd" regex="true" source="boolean(get-property('packageType'))">
        <then>
            <sequence key="filterCheckLimitSeq"/>
        </then>
        <else>
            <sequence key="celcomUserInfoSeq"/>
        </else>
    </filter>
</sequence>
